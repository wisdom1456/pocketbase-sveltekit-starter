import{s as Q,f as p,a as U,g as v,h as w,d as u,c as V,j as P,F as I,i as C,v as b,S as y,w as S,E as k,G as N,A as R,K as z,o as H,l as j,m as $,Q as T,n as W,T as M,U as B}from"./scheduler.c76fa77e.js";import{e as O,g as q,s as X,c as Y}from"./index.f8848209.js";import{S as Z,i as x}from"./index.315486b9.js";import{a as m,p as ee,t as G,c as te,d as se,e as oe,f as ae,h as le}from"./api.8bbf145a.js";import{w as ne}from"./index.b36f6ad1.js";import{a as F}from"./Alerts.a79d68e3.js";import{c as re}from"./postService.91aeda58.js";const J=ne({selectedService:"",selectedModel:""});async function K(l){try{await l()}catch(e){const{message:a,data:{data:t={}}}=e;a&&F.error(a);for(const o in t){const{message:s}=t[o];s&&F.error(`${o}: ${s}`)}}}function D(l,e,a){const t=l.slice();return t[8]=e[a],t}function ce(l,e,a){const t=l.slice();return t[11]=e[a],t}function ie(l){let e,a=l[11].name+"",t;return{c(){e=p("option"),t=j(a),this.h()},l(o){e=v(o,"OPTION",{});var s=w(e);t=$(s,a),s.forEach(u),this.h()},h(){e.__value=l[11].name,T(e,e.__value)},m(o,s){C(o,e,s),b(e,t)},p:k,d(o){o&&u(e)}}}function L(l){var h;let e,a,t,o=O(((h=m.find(l[5]))==null?void 0:h.models)??[]),s=[];for(let n=0;n<o.length;n+=1)s[n]=A(D(l,o,n));return{c(){e=p("select");for(let n=0;n<s.length;n+=1)s[n].c();this.h()},l(n){e=v(n,"SELECT",{class:!0});var c=w(e);for(let r=0;r<s.length;r+=1)s[r].l(c);c.forEach(u),this.h()},h(){P(e,"class","select select-ghost w-full max-w-xs"),l[1]===void 0&&I(()=>l[6].call(e))},m(n,c){C(n,e,c);for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(e,null);y(e,l[1],!0),a||(t=[S(e,"change",l[6]),S(e,"change",l[3])],a=!0)},p(n,c){var r;if(c&1){o=O(((r=m.find(n[5]))==null?void 0:r.models)??[]);let i;for(i=0;i<o.length;i+=1){const f=D(n,o,i);s[i]?s[i].p(f,c):(s[i]=A(f),s[i].c(),s[i].m(e,null))}for(;i<s.length;i+=1)s[i].d(1);s.length=o.length}c&3&&y(e,n[1])},d(n){n&&u(e),N(s,n),a=!1,R(t)}}}function A(l){let e,a=l[8]+"",t,o;return{c(){e=p("option"),t=j(a),this.h()},l(s){e=v(s,"OPTION",{});var h=w(e);t=$(h,a),h.forEach(u),this.h()},h(){e.__value=o=l[8],T(e,e.__value)},m(s,h){C(s,e,h),b(e,t)},p(s,h){h&1&&a!==(a=s[8]+"")&&W(t,a),h&1&&o!==(o=s[8])&&(e.__value=o,T(e,e.__value))},d(s){s&&u(e)}}}function he(l){let e,a,t,o,s,h=O(m),n=[];for(let r=0;r<h.length;r+=1)n[r]=ie(ce(l,h,r));let c=l[0]&&L(l);return{c(){e=p("div"),a=p("select");for(let r=0;r<n.length;r+=1)n[r].c();t=U(),c&&c.c(),this.h()},l(r){e=v(r,"DIV",{class:!0});var i=w(e);a=v(i,"SELECT",{class:!0});var f=w(a);for(let _=0;_<n.length;_+=1)n[_].l(f);f.forEach(u),t=V(i),c&&c.l(i),i.forEach(u),this.h()},h(){P(a,"class","select select-ghost w-full max-w-xs"),l[0]===void 0&&I(()=>l[4].call(a)),P(e,"class","flex items-center bg-primary text-primary-content")},m(r,i){C(r,e,i),b(e,a);for(let f=0;f<n.length;f+=1)n[f]&&n[f].m(a,null);y(a,l[0],!0),b(e,t),c&&c.m(e,null),o||(s=[S(a,"change",l[4]),S(a,"change",l[2])],o=!0)},p(r,[i]){i&1&&y(a,r[0]),r[0]?c?c.p(r,i):(c=L(r),c.c(),c.m(e,null)):c&&(c.d(1),c=null)},i:k,o:k,d(r){r&&u(e),N(n,r),c&&c.d(),o=!1,R(s)}}}function fe(l,e,a){var f,_;let{selectedService:t=((f=m[0])==null?void 0:f.name)??""}=e,{selectedModel:o=((_=m[0])==null?void 0:_.models[0])??""}=e;const s=z();H(()=>{var d;t||(a(0,t=m[0].name),s("serviceChange",t)),o||(a(1,o=((d=m.find(E=>E.name===t))==null?void 0:d.models[0])??""),s("modelChange",o))});function h(){var d;s("serviceChange",t),a(1,o=((d=m.find(E=>E.name===t))==null?void 0:d.models[0])??""),s("modelChange",o)}function n(){s("modelChange",o)}function c(){t=M(this),a(0,t)}const r=d=>d.name===t;function i(){o=M(this),a(1,o),a(0,t)}return l.$$set=d=>{"selectedService"in d&&a(0,t=d.selectedService),"selectedModel"in d&&a(1,o=d.selectedModel)},[t,o,h,n,c,r,i]}class we extends Z{constructor(e){super(),x(this,e,fe,he,Q,{selectedService:0,selectedModel:1})}}async function g(l,e,a){try{if(console.log("Calling API..."),!l||!e){console.log("Selected service: ",l),console.log("Selected model: ",e);const s=m[0];l=s.name,e=s.models[0],console.log("Default service selected: ",l),console.log("Default model selected: ",e)}const t=await fetch(`/api/${l.toLowerCase()}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:a,model:e})});if(console.log("Response:",t),!t.ok)throw new Error("Network response was not ok");const o=await t.json();return console.log("Data:",o),o.result}catch(t){throw console.error("Error:",t),t}}async function be(l,e,a){let t={title:"",slug:"",body:"",blogSummary:"",featuredImage:"",prompt:"",userid:a.id,tags:[]};try{const{selectedService:o,selectedModel:s}=B(J);t.body=await g(o,s,`${ee}'${l}'`),t.title=await g(o,s,`${G}'${t.body}'`);const h=await g(o,s,`${te}'${t.body}'`);t.blogSummary=await g(o,s,`${se}'${t.body}'`),t.slug=t.title.toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").substring(0,50),t.prompt=l;const n=h.split(",").map(f=>f.trim()).filter(f=>f),c=await oe(n);t.tags=c;const r=await g(o,s,`${ae}'${t.body}'`),i=await re(t,r,e);if(i!==void 0)q(`http://localhost:5173/posts/${i.slug}`);else throw new Error("Failed to create the post.")}catch(o){throw K(()=>`Failed to generate and save post: ${o}`),o}}async function ye(l,e,a){let t={title:"",content:"",post:e,slug:""};try{const{selectedService:o,selectedModel:s}=B(J),[h,n]=await Promise.all([g(o,s,`${le} + "  " + '${l}'`),g(o,s,`${G}'${l}'`)]);t.slug=n.toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").substring(0,50),t.content=h,t.title=n,await X("subpost",t,!0);const c=await Y.collection("posts").getOne(e);q(`http://localhost:5173//posts/${c.slug}`)}catch(o){throw K(()=>`Failed to generate and save subpost: ${o}`),o}}export{we as S,K as a,ye as b,be as g,J as s};

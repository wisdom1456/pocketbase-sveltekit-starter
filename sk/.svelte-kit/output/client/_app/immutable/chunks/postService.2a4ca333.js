import{c}from"./index.23ea4071.js";import{w as l}from"./index.b36f6ad1.js";import{a as u}from"./Alerts.3d0f1509.js";async function g(e){try{return await e()}catch(r){const{message:t,data:{data:a={}}={}}=r;t&&u.error(t);for(const o in a){const{message:s}=a[o];s&&u.error(`${o}: ${s}`)}return null}}async function d(e,r){try{const t=await fetch("/api/dreamstudio",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e,engineId:r})});if(!t.ok){const o=await t.json();throw console.error(`Failed to generate image: ${t.statusText}`,o),new Error(`Failed to generate image: ${t.statusText}`)}return(await t.json()).id}catch(t){throw console.error("Error creating image:",t),t}}async function f(e){var r;if((r=e.expand)!=null&&r.featuredImage){const t=e.expand.featuredImage;if("file"in t&&"id"in t&&"collectionId"in t&&"collectionName"in t)try{return c.getFileUrl(t,t.file)}catch(a){return console.error("Error getting featured image URL:",a),"https://via.placeholder.com/800x400.png?text=cool+wind"}}}async function m(e){var r;if((r=e.expand)!=null&&r.tags)return e.expand.tags.map(t=>t.title);if(e.tags&&e.tags.length>0){const t=e.tags.map(a=>`id = "${a}"`).join(" || ");try{return(await c.collection("tags").getFullList(void 0,{filter:t})).map(o=>o.title)}catch(a){return console.error("Error fetching tags:",a),[]}}return[]}async function i(e){const r=await f(e),t=await m(e);return{...e,featuredImage:r,tags:t}}async function x(e=1,r=20){try{const t=await c.collection("posts").getList(e,r,{sort:"-updated",expand:"featuredImage,tags"}),o={posts:await Promise.all(t.items.map(i)),page:t.page,perPage:t.perPage,totalPages:t.totalPages};return p.set(o),o}catch(t){return console.error("Error fetching posts:",t),null}}async function I(e){try{const r=encodeURIComponent(e),t=await c.collection("posts").getFirstListItem(`slug = "${r}"`,{expand:"featuredImage,tags"});return await i(t)}catch(r){throw console.error("Error fetching post:",r),r}}async function b(e,r,t){return await g(async()=>{const a=await d(r,t);if(a)e.featuredImage=a;else throw new Error("Failed to generate image");const o=await c.collection("posts").create(e),s=await i(o);return p.update(n=>({...n,posts:[...n.posts,s]})),s})}async function E(e){try{return await c.collection("subpost").getFullList(200,{filter:`post = "${e}"`,expand:"post"})}catch(r){throw console.error("Error fetching subposts:",r),r}}async function F(e,r){try{const t=await c.collection("posts").update(e,r),a=await i(t);return p.update(o=>{const s=o.posts.findIndex(n=>n.id===e);if(s!==-1){const n=[...o.posts];return n[s]=a,{...o,posts:n}}return o}),a}catch(t){return console.error("Error updating post:",t),null}}function w(){const{subscribe:e,set:r,update:t}=l({posts:[],page:1,perPage:20,totalPages:1});return{subscribe:e,set:r,update:t,appendPosts:(a,o)=>t(s=>({...s,posts:[...s.posts,...a],totalPages:o})),reset:()=>r({posts:[],page:1,perPage:20,totalPages:1})}}const p=w();export{g as a,I as b,E as c,b as d,x as f,p,F as u};

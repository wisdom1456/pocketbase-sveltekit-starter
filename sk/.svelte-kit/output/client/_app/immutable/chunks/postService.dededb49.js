import{c}from"./index.cad83b43.js";import{w as l}from"./index.b36f6ad1.js";import{a as i}from"./Alerts.0be9a70c.js";async function d(e){try{return await e()}catch(r){const{message:t,data:{data:o={}}={}}=r;t&&i.error(t);for(const a in o){const{message:s}=o[a];s&&i.error(`${a}: ${s}`)}return null}}async function g(e,r){try{const t=await fetch("/api/dreamstudio",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e,engineId:r})});if(!t.ok){const a=await t.json();throw console.error(`Failed to generate image: ${t.statusText}`,a),new Error(`Failed to generate image: ${t.statusText}`)}return(await t.json()).id}catch(t){throw console.error("Error creating image:",t),t}}async function f(e){var r;if((r=e.expand)!=null&&r.featuredImage){const t=e.expand.featuredImage;if("file"in t&&"id"in t&&"collectionId"in t&&"collectionName"in t)try{return c.getFileUrl(t,t.file)}catch(o){return console.error("Error getting featured image URL:",o),"https://via.placeholder.com/800x400.png?text=cool+wind"}}}async function m(e){var r;if((r=e.expand)!=null&&r.tags)return e.expand.tags.map(t=>t.title);if(e.tags&&e.tags.length>0){const t=e.tags.map(o=>`id = "${o}"`).join(" || ");try{return(await c.collection("tags").getFullList(void 0,{filter:t})).map(a=>a.title)}catch(o){return console.error("Error fetching tags:",o),[]}}return[]}async function u(e){const r=await f(e),t=await m(e);return{...e,featuredImage:r,tags:t}}async function x(e=1,r=20){try{return(await c.collection("posts").getList(e,r,{sort:"-updated",expand:"featuredImage,tags"})).items}catch(t){return console.error("Error fetching posts:",t),i.error("Failed to fetch posts. Please try again."),[]}}async function I(e){try{const r=encodeURIComponent(e),t=await c.collection("posts").getFirstListItem(`slug = "${r}"`,{expand:"featuredImage,tags"});return await u(t)}catch(r){throw console.error("Error fetching post:",r),r}}async function b(e,r,t){return await d(async()=>{const o=await g(r,t);if(o)e.featuredImage=o;else throw new Error("Failed to generate image");const a=await c.collection("posts").create(e),s=await u(a);return p.update(n=>({...n,posts:[...n.posts,s]})),s})}async function F(e){try{return await c.collection("subpost").getFullList(200,{filter:`post = "${e}"`,expand:"post"})}catch(r){throw console.error("Error fetching subposts:",r),r}}async function E(e,r){try{const t=await c.collection("posts").update(e,r),o=await u(t);return p.update(a=>{const s=a.posts.findIndex(n=>n.id===e);if(s!==-1){const n=[...a.posts];return n[s]=o,{...a,posts:n}}return a}),o}catch(t){return console.error("Error updating post:",t),null}}function h(){const{subscribe:e,set:r,update:t}=l({posts:[],page:1,perPage:20,totalPages:1});return{subscribe:e,set:r,update:t,appendPosts:(o,a)=>t(s=>({...s,posts:[...s.posts,...o],totalPages:a})),reset:()=>r({posts:[],page:1,perPage:20,totalPages:1})}}const p=h();export{d as a,I as b,F as c,b as d,x as f,p,E as u};
